<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JVmipcl: Fixed Charge Network Flows</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MIPCLlogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JVmipcl
   &#160;<span id="projectnumber">1.4.0</span>
   </div>
   <div id="projectbrief">Mixed Integer Programming Class Library: java backend</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Fixed Charge Network Flows </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_JVfcnf"></a>
Fixed Charge Network Flows</h1>
<p>In practice, we usually develop programs for solving problems that are specializations of the general MIP. In programs that are designed to solve problems the code and data are separated. We can write a <b>MIPCL</b> program for solving a problem in a similar way when we write a program that solves a MIP instance: first create an <code>MIP</code> object, next use its functions to build an instance for given input data, and then solve this instance. But in many cases it is more convenient (sometimes it is necessary) to develop a new class derived from <code>MIP</code> (or <code>LP</code> if an LP is solved). Next, we demonstrate how to do this on a simple example.</p>
<h2><a class="anchor" id="FCNFdef"></a>
Fixed charge flow network problem</h2>
<p>A transportation network is given by a directed graph (digraph) <img class="formulaInl" alt="$G=(V,E)$" src="form_3.png"/>. For each node <img class="formulaInl" alt="$v\in V$" src="form_4.png"/>, we know the <em>demand</em> <img class="formulaInl" alt="$d_v$" src="form_5.png"/> for some product. The demand is positive for <em>demand nodes</em>, negative for <em>supply nodes</em>, end zero for <em>transit nodes</em>. It is assumed that supply and demand are balanced: <img class="formulaInl" alt="$\sum_{v\in V} d_v = 0$" src="form_6.png"/>. The capacity of an arc <img class="formulaInl" alt="$e\in E\text{ is } u_e &gt; 0$" src="form_7.png"/>, and the cost of shipping <img class="formulaInl" alt="$x_e &gt; 0$" src="form_8.png"/> units of product along this arc is <img class="formulaInl" alt="$f_e + c_e x_e$" src="form_9.png"/>. Naturally, if the product is not moved through the arc ( <img class="formulaInl" alt="$x_e=0$" src="form_10.png"/>), then nothing is paid. The <em>fixed charge network flow problem</em> (FCNF) is to decide on how to transport the product from supply nodes to demand nodes so that the transportation expenses are minimum.</p>
<p>The FCNF problem appears as a subproblem in many practical applications such as design of transportation and telecommunication networks, production planning problems.</p>
<p>An instance of FCNF problem is presented in Figure 1, where the node numbers and demands are depicted in the upper and lower segments of the node circles. Any (undirected) edge <img class="formulaInl" alt="$e=(i,j)$" src="form_11.png"/> represents two (directed) arcs <img class="formulaInl" alt="$e_1=(i,j)\text{ and } e_2=(j,i)$" src="form_12.png"/>. All horizontal arcs have capacity <img class="formulaInl" alt="$u_e=3$" src="form_13.png"/>, fixed cost <img class="formulaInl" alt="$f_e=1$" src="form_14.png"/> and per-unit cost <img class="formulaInl" alt="$c_e=0$" src="form_15.png"/>, and all vertical arcs have capacity <img class="formulaInl" alt="$u_e=4$" src="form_16.png"/>, fixed cost <img class="formulaInl" alt="$f_e=2$" src="form_17.png"/> and per-unit cost <img class="formulaInl" alt="$c_e=0$" src="form_15.png"/>.</p>
<div class="image">
<img src="gridgraph.png" alt="gridgraph.png"/>
<div class="caption">
Figure 1: Example of FCNF</div></div>
 <p>Introducing variables</p><ul>
<li><img class="formulaInl" alt="$x_e$" src="form_18.png"/>: <em>flow</em> (quantity of shipping product) through arc <img class="formulaInl" alt="$e\in E$" src="form_19.png"/>,</li>
<li><img class="formulaInl" alt="$y_e=1,\text{ if product is shipped } (x_e &gt; 0)\text{ through arc } e,\text{ and } y_e=0\text{ otherwise}$" src="form_20.png"/>,</li>
</ul>
<p>we formulate the FCNF problem as follows: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align} \sum_{e\in E} (f_e y_e + c_e x_e) \to \min,&amp; \tag{1.a} \\ \sum_{e\in E(V,v)} x_e - \sum_{e\in E(v,V)} x_e = d_v,&amp;\quad v\in V,\tag{1.b}\\ 0\le x_e \le u_e y_e,&amp;\quad e\in E,\tag{1.c}\\ y_e \in \{0,1\},&amp;\quad e\in E.\tag{1.d} \end{align}" src="form_21.png"/>
</p>
<p>Here the objective (1.a) is to minimize transportation expenses. The <em>balance equations</em> (1.b) require that the number of flow units entering each particular node equals the number of flow units leaving the node. The <em>variable upper bounds</em> (1.c) are <em>capacity restrictions</em> with the following meaning:</p><ul>
<li>the flow value through any arc cannot exceed the capacity of the arc;</li>
<li>if some arc is not used for shipping product ( <img class="formulaInl" alt="$y_e=0$" src="form_22.png"/>), then the flow value through this arc is zero ( <img class="formulaInl" alt="$x_e=0$" src="form_10.png"/>).</li>
</ul>
<h2><a class="anchor" id="classCFCNF"></a>
Class Fcnf</h2>
<p>Class <code>Fcnf</code> implements MIP (1).</p>
 <div class="fragment"><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.FileReader;</div><div class="line"><span class="keyword">import</span> java.io.FileWriter;</div><div class="line"><span class="keyword">import</span> java.io.BufferedWriter;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.Scanner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceby.html">by</a>.<a class="code" href="namespaceby_1_1bsu.html">bsu</a>.<a class="code" href="namespaceby_1_1bsu_1_1JVmipcl.html">JVmipcl</a>.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>Fcnf <span class="keyword">extends</span> MIP</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> vertNum, edgeNum;</div><div class="line">        <span class="keywordtype">int</span>[] demand;</div><div class="line">        <span class="keywordtype">int</span>[] tail, head, capacity, fixedCost, cost;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> Fcnf(String name)</div><div class="line">        {</div><div class="line">                super(name);</div><div class="line">                vertNum = edgeNum = 0;</div><div class="line">        } <span class="comment">// end of Fcnf(String name)</span></div></div><!-- fragment --></p>
<p>First we describe the members of <em>Fcnf</em>:</p><ul>
<li><code>vertNum</code>: number of vertices (nodes);</li>
<li><code>edgeNum</code>: number of arcs (edges);</li>
<li><code>demand</code>: array of size <code>vertNum</code>, where <code>demand[i]</code> is demand at node <code>i</code>;</li>
<li><code>tail, head</code>: arrays of size <code>edgeNum</code>, where arc <code>e</code> leaves node <code>tail[e]</code> and enters node <code>head[e]</code>;</li>
<li><code>capacity, fixedCost, cost</code>: arrays of size <code>edgeNum</code>, where <code>capacity[e]</code>, <code>fixedCost[e]</code>, and <code>cost[e]</code> are, respectively, <em>capacity</em>, <em>fixed cost</em>, and <em>per-unit cost</em> of arc <code>e</code>.</li>
</ul>
<p>The constructor creates an "empty" <code>MIP</code> object, passing the name of the problem to the constructor of the base class <code>CMIP</code>.</p>
<p>Class <code>Fcnf</code> has only three functions other than the constructor and the destructor:</p><ul>
<li><code>readNet()</code>: reads an <em>FCNF</em> instance from a text file;</li>
<li><code>buildProb()</code>: builds a <b>MIPCL</b> model for MIP (1)-(4);</li>
<li><code>printSolution()</code>: overloads the function of the base class <code>MIP</code>.</li>
</ul>
<p><div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> readNet(String filename) <span class="keywordflow">throws</span> FileNotFoundException {</div><div class="line">                Scanner scan = <span class="keyword">new</span> Scanner(<span class="keyword">new</span> FileReader(filename));</div><div class="line">                vertNum = scan.nextInt();</div><div class="line">                edgeNum = scan.nextInt();</div><div class="line">                demand = <span class="keyword">new</span> <span class="keywordtype">int</span>[vertNum];</div><div class="line">                tail = <span class="keyword">new</span> <span class="keywordtype">int</span>[edgeNum];</div><div class="line">                head = <span class="keyword">new</span> <span class="keywordtype">int</span>[edgeNum];</div><div class="line">                capacity = <span class="keyword">new</span> <span class="keywordtype">int</span>[edgeNum];</div><div class="line">                fixedCost = <span class="keyword">new</span> <span class="keywordtype">int</span>[edgeNum];</div><div class="line">                cost = <span class="keyword">new</span> <span class="keywordtype">int</span>[edgeNum];</div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v &lt; vertNum; ++v) {</div><div class="line">                        demand[v] = scan.nextInt();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> e=0; e &lt; edgeNum; ++e) {</div><div class="line">                        tail[e] = scan.nextInt();</div><div class="line">                        head[e] = scan.nextInt();</div><div class="line">                        capacity[e] = scan.nextInt();</div><div class="line">                        fixedCost[e] = scan.nextInt();</div><div class="line">                        cost[e] = scan.nextInt();</div><div class="line">                }</div><div class="line">                scan.close();</div><div class="line">        } <span class="comment">// end of readNet()</span></div></div><!-- fragment --></p>
<p>The function <code>readNet()</code> reads an instance of FCNF problem from a text file of the following format: Line 1 contains 2 integer numbers <em>n</em> and <em>m</em> (number of nodes and number of edges); staring from Line 2, node demands are written as <em>n</em> integer numbers, the <em>i</em>-th number is the demand at node <em>i</em>; demands are followed by <em>m</em> lines with arc parameters, the <em>i</em>-th of these lines contains 5 numbers, respectively, the head, tail, capacity, fixed cost, and cost of arc <em>i</em>. Our test example on the grid graph is described in the file <code>grid.txt</code> which can be found in the folder </p><pre class="fragment">$MIPCLDIR/mipcl-java/examples/fcfn/tests
</pre><p>reserved for our FCFN application.</p>
<p>The implementation of <code>buildProb()</code> is the following. <div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> buildProb()</div><div class="line">        {</div><div class="line">                <span class="keyword">final</span> <span class="keywordtype">double</span>[] val = {-1.0, 1.0, 1.0};</div><div class="line">                <span class="keywordtype">double</span>[] w = <span class="keyword">new</span> <span class="keywordtype">double</span>[1];</div><div class="line">                <span class="keywordtype">int</span>[] row = <span class="keyword">new</span> <span class="keywordtype">int</span>[3];</div><div class="line">                <span class="keywordtype">int</span>[] r = <span class="keyword">new</span> <span class="keywordtype">int</span>[1];</div><div class="line">                <span class="keywordtype">int</span> ctrNum=vertNum+edgeNum;</div><div class="line"></div><div class="line">                openMatrix(vertNum+edgeNum,2*edgeNum,4*edgeNum);</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v &lt; vertNum; ++v) {</div><div class="line">                        addCtr(v,0,demand[v],demand[v]);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> e=vertNum; e &lt; ctrNum; ++e) {</div><div class="line">                        addCtr(e,0,-INF,0.0);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> e=0; e &lt; edgeNum; ++e) {</div><div class="line">                        row[0] = tail[e]; row[1] = head[e];</div><div class="line">                        row[2] = r[0] = vertNum+e;</div><div class="line">                        addColumn(e,0,-cost[e],0.0,VAR_INF,val,row,<span class="keyword">true</span>);</div><div class="line">                        w[0] = -capacity[e];</div><div class="line">                        addColumn(e+edgeNum,VAR_BIN,-fixedCost[e],0.0,1.0,w,r,<span class="keyword">true</span>);</div><div class="line">                }</div><div class="line">                closeMatrix();</div><div class="line">        } <span class="comment">// end of buildProb()</span></div></div><!-- fragment --> </p><dl class="section see"><dt>See also</dt><dd>MIP.openMatrix(), LP.addCtr(), LP.addColumn(), MIP.closeMatrix().</dd></dl>
<p>First <code>buildProb()</code> opens the matrix with <code>vertNum+edgeNum</code> rows and <code>2*edgeNum</code> columns, what exactly corresponds to the number of constraints and variables in program (1). The rows <code>i=0,...,vertNum-1</code> correspond to the equations (1.b), and the rows <code>e=vertNum,...,vertNum+edgeNum-1</code> correspond to the inequalities (1.c). For <code>e=0,...,edgeNum-1</code>, the variable <img class="formulaInl" alt="$x_e$" src="form_18.png"/> correspond to the column indexed with <code>e</code> which has three nonzero entries: <code>-1</code> in row <code>tail[e]</code>, <code>1</code> in row <code>head[e]</code>, and another <code>1</code> in row <code>vertNum+e</code>. The variable <img class="formulaInl" alt="$y_e$" src="form_23.png"/> corresponds to column <code>edgeNum+e</code> which has only one nonzero entry <code>-capacity[e]</code> ( <img class="formulaInl" alt="$-u_e$" src="form_24.png"/>) in row <code>vertNum+e</code>.</p>
<p>It worth noting that in this applications, until the matrix is closed, the column indexes coincide with their handles. Since the column structure is simpler than the row structure, we build the matrix by adding columns. But first we have to describe the rows. Nonzero entries of the constraint matrix are added with the function <code>addColumn()</code>.</p>
<p>In order to display solutions in a more readable form, <code>Fcnf</code> overloads the function <code>MIP.printSolution()</code> of the base class <code>MIP</code>.</p>
<p><div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> printSolution(String filename) <span class="keywordflow">throws</span> IOException</div><div class="line">        {</div><div class="line">                BufferedWriter bfWriter =</div><div class="line">                        <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(filename));</div><div class="line">                <span class="keywordflow">if</span> (isSolution()) {</div><div class="line">                        <span class="keywordtype">int</span> varNum = 2*edgeNum;</div><div class="line">                        getSolution();</div><div class="line">                        <span class="keywordtype">double</span>[] X = getX();</div><div class="line">                        <span class="keywordtype">int</span>[] hd = getVarHandles();</div><div class="line">                        bfWriter.write(<span class="stringliteral">&quot;Nonzero flows:\n&quot;</span>);</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; varNum; ++i) {</div><div class="line">                                <span class="keywordflow">if</span> (hd[i] &lt; edgeNum &amp;&amp; X[i] &gt; 0.5) {</div><div class="line">                                        bfWriter.write(<span class="stringliteral">&quot;f(&quot;</span> + tail[hd[i]] + <span class="stringliteral">&quot;,&quot;</span> + head[hd[i]]</div><div class="line">                                                 + <span class="stringliteral">&quot;)=&quot;</span> + X[i] + <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">                                }</div><div class="line">                        }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                        bfWriter.write(<span class="stringliteral">&quot;Problem has no solution!\n&quot;</span>);</div><div class="line">                bfWriter.close();</div><div class="line">        } <span class="comment">// end of printSolution()</span></div></div><!-- fragment --></p>
<p>This function writes to the output file only nonzero values <img class="formulaInl" alt="$x_e$" src="form_18.png"/>. To get the pointers to the array representing the solution, we call the function <code>getSolution()</code>, which "extracts" the solution found by the <b>MIPCL</b>. returns two pointers <code>dpX</code> and <code>ipHd</code>, where <code>dpX[i]</code> is the value of the variable with handle <code>ipHd[i]</code>. It is important to remember that <b>MIPCL</b> does not preserve the order in which the variables were added to the matrix.</p>
<h2><a class="anchor" id="CFCNFusing"></a>
Using `Fcnf`</h2>
<div class="fragment"><div class="line"><span class="keyword">package </span>fcnf;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>testFcnf</div><div class="line">{</div><div class="line">        <span class="keyword">static</span> {</div><div class="line">            System.loadLibrary(<span class="stringliteral">&quot;JVmipcl&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> main(String[] args) {</div><div class="line">                <span class="keywordflow">if</span> (args.length &lt; 1) {</div><div class="line">                        System.out.println(<span class="stringliteral">&quot;File name is omitted!\n&quot;</span>);</div><div class="line">                        <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                String path = args[0];</div><div class="line">                <span class="keywordtype">int</span> i1 = path.lastIndexOf(<span class="charliteral">&#39;/&#39;</span>) + 1;</div><div class="line">                <span class="keywordtype">int</span> i2 = path.lastIndexOf(<span class="charliteral">&#39;.&#39;</span>);</div><div class="line">                <span class="keywordflow">if</span> (i2 &lt; 0)</div><div class="line">                        i2 = path.length();</div><div class="line">                String name = path.substring(i1,i2);</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                        Fcnf prob = <span class="keyword">new</span> Fcnf(name);</div><div class="line">                        prob.readNet(path);</div><div class="line">                        prob.buildProb();</div><div class="line">                        prob.optimize();</div><div class="line">                        prob.printSolution(name+<span class="stringliteral">&quot;.sol&quot;</span>);</div><div class="line">                        prob.dispose();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">catch</span>(Throwable e) {</div><div class="line">                        System.out.println(e);</div><div class="line">                }</div><div class="line">        }</div><div class="line">}</div></div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd>MIP.optimize().</dd></dl>
<p>In Linux, to compile this test, do the following: </p><pre class="fragment"> cd $MIPCLDIR/mipcl-java/examples/fcnf
 ./compile
</pre><p>If we run our test program </p><pre class="fragment"> ./run tests/grid.txt
</pre><p>with input parameter set to <code>tests/grid.txt</code>, we get the answer written into the file named <code>grid.sol</code>, and depicted in Figure 2.</p>
<div class="image">
<img src="gridgraphSol.png" alt="gridgraphSol.png"/>
<div class="caption">
Figure 2: Solution to FCNF example</div></div>
  <b>Remark</b>: On Windows computers, to compile applications and then run tests, we execute two batch files <code>compile.bat</code> and <code>run.but</code>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 12 2017 00:28:59 for JVmipcl by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
