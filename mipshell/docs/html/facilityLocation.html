<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MIPschell: Service Facility Location</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MIPschell
   &#160;<span id="projectnumber">1.3.0</span>
   </div>
   <div id="projectbrief">A language for writing Mixed Integer Programs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Service Facility Location </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="mipshell_FL"></a>
Service Facility Location</h1>
<p>The problem of facility location is critical to a company's eventual success. Service companies' location decisions are guided by variety of criteria. A location close to the customer is especially important because this enables faster delivery goods and services.</p>
<p>Given a set of customer locations <img class="formulaInl" alt="$N=\{1,\dots,n\}$" src="form_41.png"/> with <img class="formulaInl" alt="$b_j$" src="form_42.png"/> customers at location <img class="formulaInl" alt="$j\in N$" src="form_43.png"/>, a set of potential sites <img class="formulaInl" alt="$M=\{1,\dots,m\}$" src="form_44.png"/> for locating depots, a fixed cost <img class="formulaInl" alt="$f_i$" src="form_45.png"/> of locating a depot at site <em>i</em>, a capacity <img class="formulaInl" alt="$a_i$" src="form_46.png"/> of the depot at site&#160;_i, and a cost <img class="formulaInl" alt="$c_{ij}$" src="form_47.png"/> of serving customer&#160;<em>j</em> from site <em>i</em> during some planning horizon. The <em>facility location problem</em> (FLP) is to decide where to locate depots so that to minimize the total cost of locating depots and serving customers.</p>
<p>Choosing the following decision variables</p><ul>
<li><img class="formulaInl" alt="$y_i=1$" src="form_34.png"/> if depot is located at site&#160;<em>i</em> and <img class="formulaInl" alt="$y_i=0$" src="form_35.png"/> otherwise,</li>
<li><img class="formulaInl" alt="$x_{ij}$" src="form_36.png"/>: number of customers of location&#160;<em>j</em> served from depot established at site&#160;<em>i</em>, we formulate the problem as follows:</li>
</ul>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align} &amp;\sum_{i=1}^m \sum_{j=1}^n c_{ij} x_{ij} + \sum_{i=1}^m f_i y_i \to \min \tag{1.a}\\ &amp;\sum_{i=1}^m x_{ij} = b_j,\quad j=1,\ldots,n, \tag{1.b}\\ &amp;\sum_{j=1}^n x_{ij} \le a_i y_i,\quad i=1,\ldots,m. \tag{1.c}\\ &amp;x_{ij}\le \min\{a_i,b_j\} y_i ,\quad i=1,\ldots,m,\; j=1,\ldots,n, \tag{1.d}\\ &amp;y_i \in \{0,1\},\quad i=1,\ldots,m, \tag{1.e}\\ &amp;x_{ij}\in \mathbb{Z}_+,\quad i=1,\ldots,m,\; j=1,\ldots,n. \tag{1.f} \end{align}" src="form_48.png"/>
</p>
<p>The objective (1.a) is to minimize the total cost of locating depots and serving customers. The constraints (1.b) insure that each customer is served. The capacity constraints (1.c) induce that at most <img class="formulaInl" alt="$a_i$" src="form_46.png"/> customers can be served from site&#160;<em>i</em>. The redundant constraints (1.d) are implied by the capacity constraints. They were introduced to strengthen the IP formulation.</p>
<p>Let us note, that if all <img class="formulaInl" alt="$c_{ij}=0$" src="form_49.png"/> and all <img class="formulaInl" alt="$f_i=1$" src="form_50.png"/>, then problem (1) is to minimize the number of depots needed to serve all customers.</p>
<h2><a class="anchor" id="mipshell_FLimpl"></a>
MIPshell-implementation</h2>
<p>A <b>MIPshell</b> application for solving FLP's is located in the following folder </p><pre class="fragment"> $MIPCLDIR/examples/mipshell/fl
</pre><p>The core of this application is a <b>C++</b> class <code>Cfl</code>, which definition is as follows.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mipshell_8h.html">mipshell.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>Cfl: <span class="keyword">public</span> <a class="code" href="classCProblem.html">CProblem</a></div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> m_iLocationNum, m_iSiteNum, m_iQ;</div><div class="line">    <span class="keywordtype">int</span> *m_ipPopulation, *m_ipCapacity, *m_ipFixedCost, *m_ipCost;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Cfl(<span class="keyword">const</span> <span class="keywordtype">char</span>* name);</div><div class="line"><span class="preprocessor">#ifdef __THREADS_</span></div><div class="line">    Cfl(<span class="keyword">const</span> Cfl &amp;other, <span class="keywordtype">int</span> thread);</div><div class="line">    <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a>* <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html#a33363f035bbd0ac5746cc4753886b013">clone</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a> *pMip, <span class="keywordtype">int</span> thread);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keyword">virtual</span> ~Cfl();</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> model();</div><div class="line">    </div><div class="line">    <span class="keywordtype">void</span> readData(<span class="keyword">const</span> <span class="keywordtype">char</span> *fileName);</div><div class="line">    <span class="keywordtype">void</span> printSol(<a class="code" href="classCVarVector.html">VAR_VECTOR</a> &amp;x, <a class="code" href="classCVarVector.html">VAR_VECTOR</a> &amp;y);</div><div class="line">};</div><div class="line"></div></div><!-- fragment --><p><code>Cfl</code> stores problem instances in the following its members:</p>
<ul>
<li><code>m_iLocationNum</code>: number of possible locations;</li>
<li><code>m_iSiteNum</code>: number of potential sites for locating depots;</li>
<li><code>m_iQ</code>: maximum number of depots;</li>
<li><code>m_ipPopulation</code>: array of size <code>m_iLocationNum</code>, where <code>m_ipPopulation[j]</code> is number of customers at location <code>j</code>;</li>
<li><code>m_ipFixedCost</code>: array of size <code>m_iPlaceNum, where</code>m_ipFixedCost[i]<code>is fixed cost of locating depot at site</code>i<code>; -</code>m_ipCapacity<code>: array of size</code>m_iPlaceNum<code>, where</code>m_ipCapacity[i]<code>is capacity of depotif it is allocated at site</code>i<code>; -</code>m_ipCost<code>: array of size</code>m_iPlaceNum*m_iCustomNum<code>, where</code>m_ipCost[i,j]<code>is cost of serving customer</code>j<code>from depot</code>i`.</li>
</ul>
<p>The default constructor of <code>Cfl</code> is implemented as follows.</p>
<p><div class="fragment"><div class="line">Cfl::Cfl(<span class="keyword">const</span> <span class="keywordtype">char</span>* name): <a class="code" href="classCProblem.html">CProblem</a>(name)</div><div class="line">{</div><div class="line">    m_ipCost=0;</div><div class="line">    <span class="keywordtype">char</span> fileName[128];</div><div class="line">    strcpy(fileName,name);</div><div class="line">    strcat(fileName,<span class="stringliteral">&quot;.txt&quot;</span>);</div><div class="line">    readData(fileName);</div><div class="line">}</div></div><!-- fragment --></p>
<p><code>Cfl()</code> just calls the function <code>readData()</code> to read an instance of FLP from a text file which name (without extension <code>.txt</code>) is given by the parameter <code>fileName</code>.</p>
<p><div class="fragment"><div class="line"><span class="keywordtype">void</span> Cfl::readData(<span class="keyword">const</span> <span class="keywordtype">char</span>* fileName)</div><div class="line">{</div><div class="line">    std::ifstream fin(fileName);</div><div class="line">    <span class="keywordflow">if</span> (!fin.is_open()) {</div><div class="line">        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCFileException.html">CFileException</a>(<span class="stringliteral">&quot;Clotsize::readData&quot;</span>,fileName);</div><div class="line">    }</div><div class="line">    <span class="keywordtype">int</span> m, n;</div><div class="line">    fin &gt;&gt; n &gt;&gt; m &gt;&gt; m_iQ; </div><div class="line">    m_iLocationNum=n; m_iSiteNum=m;</div><div class="line">    <span class="keywordflow">if</span> (!(m_ipCost = <span class="keyword">new</span>(std::nothrow) <span class="keywordtype">int</span>[m*(n+2)+n])) {</div><div class="line">        <span class="keywordflow">throw</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMemoryException.html">CMemoryException</a>(<span class="stringliteral">&quot;Clotsize::readData&quot;</span>);</div><div class="line">    }</div><div class="line">    m_ipPopulation=(m_ipCapacity=(m_ipFixedCost=m_ipCost+m*n)+m)+m;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; n; ++j)</div><div class="line">        fin &gt;&gt; m_ipPopulation[j];</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; m; ++i)</div><div class="line">        fin &gt;&gt;  m_ipFixedCost[i] &gt;&gt; m_ipCapacity[i];</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> *ipCost=m_ipCost;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; m; ++i) {</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; n; ++j)</div><div class="line">            fin &gt;&gt;  ipCost[j];</div><div class="line">        ipCost+=n;</div><div class="line">    }</div><div class="line"></div><div class="line">    fin.close();</div><div class="line">} <span class="comment">// end of Cfl::readData</span></div></div><!-- fragment --></p>
<p>The instance read from the file is stored in the class members described above. The format of input data will be described later when we discuss an illustrative example. The function also allocates memory for the array members of <code>Cfl</code>.</p>
<p>A straightforward <b>MIPshell</b> implementation of the IP (1) is presented below.</p>
<div class="fragment"><div class="line">#define f(i) m_ipFixedCost[i]</div><div class="line">#define a(i) m_ipCapacity[i]</div><div class="line">#define b(j) m_ipPopulation[j]</div><div class="line">#define c(i,j) m_ipCost[i*n+j]</div><div class="line">#define min(a,b) ((a &lt; b)? a: b)</div><div class="line"></div><div class="line">int Cfl::model()</div><div class="line">{</div><div class="line">    int i,j, m=m_iSiteNum, n=m_iLocationNum, q=m_iQ; </div><div class="line">    VAR_VECTOR y(&quot;y&quot;,BIN,m), x(&quot;x&quot;,INT_GE,m,n);</div><div class="line">    </div><div class="line">    minimize(sum(i in [0,m)) f(i)*y(i) + sum(i in [0,m), j in [0,n)) c(i,j)*x(i,j));</div><div class="line">    </div><div class="line">    sum(i in [0,m)) y(i) &lt;= q;</div><div class="line">    </div><div class="line">    forall(j in [0,n))</div><div class="line">        sum(i in [0,m)) x(i,j) == b(j);</div><div class="line"></div><div class="line">    forall(i in [0,m))</div><div class="line">        sum(j in [0,n)) x(i,j) &lt;= a(i)*y(i);</div><div class="line"></div><div class="line">    forall(i in [0,m), j in [0,n))</div><div class="line">        x(i,j) &lt;= min(a(i),b(j))*y(i);</div><div class="line"></div><div class="line">    optimize();</div><div class="line">    printSol(x,y);</div><div class="line">    return 0;</div><div class="line">} // end of Cfl::model</div><div class="line"></div></div><!-- fragment --><p>As usual, we introduced macros to keep our <b>MIPshell</b> model close to IP formulation (1).</p>
<h2><a class="anchor" id="mipshell_FLexample"></a>
Illustrative Example: Locating Two medical Clinics</h2>
<p>Two clinics, both of capacity 40, are to be established to provide medical care for people living in five communities, A, B, C, D and E. The population of each community and distances between communities are given in Table&#160;1. Assume that clinics can be allocated at any of the communities with the same expenses (so we may assume that the fixed costs of allocating clinics are zeroes), and the population of each community is evenly distributed within the community's boundaries. The problem is to allocate two clinics so that to minimize the overall travel distance.</p>
<center> <a class="anchor" id=""></a>
<table class="doxtable">
<caption>Table 1: <em>Population and distances between communities</em></caption>
<tr>
<th>Com- </th><th colspan="5">Distance to (km) </th><th>Population  </th></tr>
<tr>
<th>munity </th><th>A </th><th>B </th><th>C </th><th>D </th><th>E </th><th>(thousands)  </th></tr>
<tr>
<th>A </th><td>0 </td><td>11 </td><td>8 </td><td>12 </td><td>15 </td><td>10  </td></tr>
<tr>
<th>B </th><td>11 </td><td>0 </td><td>10 </td><td>7 </td><td>13 </td><td>8  </td></tr>
<tr>
<th>C &amp; </th><td>8 </td><td>10 </td><td>0 </td><td>9 </td><td>9</td><td>20  </td></tr>
<tr>
<th>D </th><td>12 </td><td>7 </td><td>9 </td><td>0 </td><td>6 </td><td>12  </td></tr>
<tr>
<th>E </th><td>15 </td><td>13 </td><td>9 </td><td>6 </td><td>0 </td><td>14  </td></tr>
</table>
</center><p>To solve this example with our program, we prepared a text file, named <code>test1.txt</code>, which contents is as the following. </p><pre class="fragment">5 5 2

10 8 20 12 14

 0 40 0 40 0 40 0 40 0 40

 0 11  8 12 15
11  0 10  7 13
 8 10  0  9  9
12  7  9  0  6
15 13  9  6  0
</pre><p>If you enter the folder <code>$MIPCLDIR/examples/mipshell/fl/tests</code> and run the program <code>fl</code> with the only parameter <code>test1.txt</code>, you will get the solution written into the text file <code>test1.sol</code>, which content is as follows. </p><pre class="fragment">Overall travel distance is 220
===== Facility at site 3 serves customers:
   10     from loc. 1
   20     from loc. 3
=============================================
===== Facility at site 4 serves customers:
    8     from loc. 2
   12     from loc. 4
   14     from loc. 5
=============================================</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
