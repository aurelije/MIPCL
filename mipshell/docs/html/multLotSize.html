<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MIPschell: Multiproduct Lot-Sizing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MIPschell
   &#160;<span id="projectnumber">1.3.0</span>
   </div>
   <div id="projectbrief">A language for writing Mixed Integer Programs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Multiproduct Lot-Sizing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="mipshell_multLotSize"></a>
Multiproduct Lot-Sizing</h1>
<p>Production process</p><ul>
<li>transforms raw materials into end products;</li>
<li>usually there a series of transformation steps;</li>
<li>each step consuming and producing intermediate products;</li>
<li>raw materials, intermediate and end products may be inventoried.</li>
</ul>
<p>We need to determine an aggregate production plan for <em>n</em> different products on a number of machines of <em>m</em> types for a planning horizon that extends over <em>T</em> periods.</p>
<p>Inputs parameters:</p><ul>
<li><img class="formulaInl" alt="$l_t$" src="form_51.png"/>: duration (length) of period <em>t</em>;</li>
<li><img class="formulaInl" alt="$m_{it}$" src="form_52.png"/>: number of machines of type~$i$ available in period <em>t</em>;</li>
<li><img class="formulaInl" alt="$f_{it}$" src="form_53.png"/>: fixed cost of producing on machine of type <em>i</em> in period <em>t</em>;</li>
<li><img class="formulaInl" alt="$T^{\mathrm{min}}_{i}, T^{\mathrm{max}}_{i}$" src="form_54.png"/>: minimum and maximum working time of one machine of type <em>i</em>;</li>
<li><img class="formulaInl" alt="$c_{jt}$" src="form_55.png"/>: per unit production cost of product <em>j</em> in period <em>t</em>;</li>
<li><img class="formulaInl" alt="$h_{jt}$" src="form_56.png"/>: inventory holding cost per unit of product <em>j</em> in period <em>t</em>;</li>
<li><img class="formulaInl" alt="$d_{jt}$" src="form_57.png"/>: demand for product <em>j</em> in period <em>t</em>;</li>
<li><img class="formulaInl" alt="$\rho_{jk}$" src="form_58.png"/>: number of units of product <em>j</em> used for producing one unit of product <em>k</em>;</li>
<li><img class="formulaInl" alt="$\tau_{ij}$" src="form_59.png"/>: per unit production time of product <em>j</em> on machine of type <em>i</em>;</li>
<li><img class="formulaInl" alt="$s^i_j$" src="form_60.png"/>: initial stock of product <em>j</em> at the beginning of the planning horizon.</li>
<li><img class="formulaInl" alt="$s^f_j$" src="form_61.png"/>: final stock of product <em>j</em> at the end of the planning horizon.</li>
</ul>
<p>We need to determine the production levels for each product and each period so that to minimize the total production and inventory expenses over planing horizon.</p>
<p>We introduce the following variables <img class="formulaInl" alt="$x_{jt}$" src="form_62.png"/>: amount of product <em>j</em>, produced in period <em>t</em>; <img class="formulaInl" alt="$s_{jt}$" src="form_63.png"/>: amount of product <em>j</em> in stock at the end of period <em>t</em>; <img class="formulaInl" alt="$y_{it}$" src="form_64.png"/>: number of machunes of type <em>i</em> working in period <em>t</em>.</p>
<p>Now we formulate the problem as follows: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align} &amp; \sum_{t=1}^T\sum_{j=1}^n \left(h_{jt}\, s_{jt} + c_{jt}\, x_{jt}\right) + \sum_{t=1}^T\sum_{i=1}^m f_{it}\, y_{it} \to \min, \tag{1.a}\\ &amp; s^i_j + x_{j1} = d_{j1} + s_{j1} + \sum_{k=1}^n \rho_{jk}\, x_{k,1},\quad j=1,\dots,n, \tag{1.b}\\ &amp; s_{j,t-1} + x_{jt} = d_{jt} + s_{jt} + \sum_{k=1}^n \rho_{jk}\, x_{k,t}, \notag \\ &amp; \phantom{xxxxxxxxxxxxxxxxxxxxx} j=1,\dots,n;\; t=2,\dots,T, \tag{1.c}\\ &amp; \sum_{j=1}^n \tau_{ij}\, x_{jt} \le l_t y_{it},\quad i=1,\dots,m;\; t=1,\dots,T, \tag{1.d}\\ &amp; s_{jT} = s^f_j,\quad j=1,\dots,n,\tag{1.e}\\ &amp; 0\le s_{jt}\le u_j,\; x_{jt}\ge 0,\quad j=1,\dots,n;\; t=1,\dots,T, \tag{1.f}\\ &amp; 0\le y_{it}\le m_{it},\; y_{it} \in \mathbb{Z},\quad i=1,\dots,m;\; t=1,\dots,T. \tag{1.g} \end{align}" src="form_65.png"/>
</p>
<p>The objective (1.a) prescribes to minimize the total production and inventory expenses.</p>
<p>The balance equations (1.b) and (1.c) join two adjacent periods: product in stock in period <em>t</em>-1 plus that produced in period <em>t</em> equals the demand in period <em>t</em> plus the amount of product used when producing other products, and plus the amount in stock in period <em>t</em>.</p>
<p>The inequalities (1.d) require that the working time of machines of any type be withing given limits; besides, if machine <em>i</em> does not work in period <em>t</em> ( <img class="formulaInl" alt="$y_{it}=0$" src="form_66.png"/>), then no product is produced by this machine (all <img class="formulaInl" alt="$x_{jt}=0$" src="form_67.png"/>).</p>
<p>The equations (1.e) set the values of final product stocks.</p>
<h2><a class="anchor" id="mipshell_multLotSizeImpl"></a>
MIPshell implementation</h2>
<p>To solve problem (1), we developed a <b>C++</b> class named <code>Cmultlotsize</code> and defined as follows.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mipshell_8h.html">mipshell.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>Cmultlotsize: <span class="keyword">public</span> <a class="code" href="classCProblem.html">CProblem</a></div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> m_iProdNum, m_iMachTypeNum,m_iT;</div><div class="line">    <span class="keywordtype">int</span> *m_ipDur, *m_ipDemand,  *m_ipMachNum,</div><div class="line">        *m_ipStockCap, *m_ipInitStock, *m_ipFinalStock;</div><div class="line">    <span class="keywordtype">double</span> *m_dpCost, *m_dpFixedCost, *m_dpHoldingCost,</div><div class="line">        *m_dpTau, *m_dpRho;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Cmultlotsize(<span class="keyword">const</span> <span class="keywordtype">char</span>* name);</div><div class="line"><span class="preprocessor">#ifdef __THREADS_</span></div><div class="line">    Cmultlotsize(<span class="keyword">const</span> Cmultlotsize &amp;other, <span class="keywordtype">int</span> thread);</div><div class="line">    <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a>* <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html#a33363f035bbd0ac5746cc4753886b013">clone</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a> *pMip, <span class="keywordtype">int</span> thread);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keyword">virtual</span> ~Cmultlotsize();</div><div class="line">    </div><div class="line">    <span class="keywordtype">void</span> readData(<span class="keyword">const</span> <span class="keywordtype">char</span>* fileName);</div><div class="line">    <span class="keywordtype">int</span> model();</div><div class="line">};</div><div class="line"></div></div><!-- fragment --><p>To store problem instances we use only "flat" arrays. This is not the best choice from the point of view of writing a transparent optimization model, which is the main motivation for using <b>MIPshell</b>. However, even with flat arrays, we can still develop clear optimization models writing macros (or inline functions) to match data stored in flat arrays with corresponding parameters of the mathematical model.</p>
<p><code>Cmultlotsize</code> has the following data members:</p>
<ul>
<li><code>m_iT</code>: number of periods in time horizon;</li>
<li><code>m_iProdNum</code>: number of products;</li>
<li><code>m_iMachTypeNum</code>: number of machines;</li>
<li><code>m_ipMachNum</code>: integer array of size <code>m_iMachTypeNum*m_iT</code>, where <code>m_dpFixedCost[t*m_iProdNum+i]</code> is number of machines of type <code>i</code> available in period <code>t</code>;</li>
<li><code>m_dpFixedCost</code>: real array of size <code>m_iMachTypeNum*m_iT</code>, where <code>m_dpFixedCost[t*m_iProdNum+i]</code> is fixed cost of starting production on machine <code>i</code> in period <code>t</code>;</li>
<li><code>m_ipStockCap,m_ipInitStock,m_ipFinalStock</code>: arrays of size <code>m_iProdNum</code>, where<ul>
<li><code>m_ipStockCap[j]</code> is stock capacity for product <code>j</code>;</li>
<li><code>m_ipInitStock[j]</code> and <code>m_ipFinalStock[j]</code> are initial and final stocks of product <code>j</code>;</li>
</ul>
</li>
<li>m_dpCost: real array of size <code>m_iProdNum*m_iT</code>, where <code>m_HoldingCost[t*m_iProdNum+j]</code> is inventory holding cost of product <code>j</code> in period <code>t</code>;</li>
<li><code>m_dpHoldingCost</code>: real array of size <code>m_iProdNum*m_iT</code>, where <code>m_dpCost[t*m_iProdNum+j]</code> is cost of producing one unit of product <code>j</code> in period <code>t</code>;</li>
<li><code>m_ipDemand</code>: integer array of size <code>m_iProdNum*m_iT</code>, where <code>m_ipDemand[t*m_iProdNum+j]</code> is demand for product <code>j</code> in period <code>t</code>;</li>
<li><code>m_ipDur</code>: integer array of size <code>m_iT</code>, where <code>m_ipDur[t]</code> is duration of period <code>t</code>;</li>
<li><code>m_dpTau</code>: real array of size <code>m_iMachTypeNum*m_iProdNum</code>, where <code>m_dpTau[i*m_iProdNum+j]</code> is per unit production time of product<code>j</code> on machine <code>i</code>;</li>
<li><code>m_dpRho</code>: real array of size <code>m_iProdNum*m_iProdNum</code>, where <code>m_dpRho[j*m_iProdNum+k]</code> is number of units of product <code>j</code> used for producing one unit of product <code>k</code>.</li>
</ul>
<p>Next, we discuss the implementation of the constructors and the destructor of <code>Cmultlotsize</code>.</p>
<p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div><div class="line"></div><div class="line">Cmultlotsize::Cmultlotsize(<span class="keyword">const</span> <span class="keywordtype">char</span>* name): <a class="code" href="classCProblem.html">CProblem</a>(name)</div><div class="line">{</div><div class="line">    m_ipDur=0;</div><div class="line">    m_dpCost=0;</div><div class="line"></div><div class="line">    <span class="keywordtype">char</span> fileName[128];</div><div class="line">    strcpy(fileName,name);</div><div class="line">    strcat(fileName,<span class="stringliteral">&quot;.txt&quot;</span>);</div><div class="line">    readData(fileName);</div><div class="line">}</div></div><!-- fragment --></p>
<p>This constructor set to zero the values of two pointer, <code>m_ipDur</code> and <code>m_dpCost</code>, that point to memory blocks allocated in <code>readData()</code> for storing all, respectively, integer and real arrays. Next <code>readData(fileName)</code> is called to read input data from the file which name is passed as the only input parameter, <code>name</code>, appended with the extension <code>.txt</code>.</p>
<p>The implementation of the copy and clone constructors are standard.</p>
<p><div class="fragment"><div class="line"><span class="preprocessor">#ifdef __THREADS_</span></div><div class="line">Cmultlotsize::Cmultlotsize(<span class="keyword">const</span> Cmultlotsize &amp;other, <span class="keywordtype">int</span> thread): <a class="code" href="classCProblem.html">CProblem</a>(other,thread)</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a>* Cmultlotsize::clone(<span class="keyword">const</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a> *pMip, <span class="keywordtype">int</span> thread)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a>*<span class="keyword">&gt;</span>(<span class="keyword">new</span> Cmultlotsize(*static_cast&lt;Cmultlotsize*&gt;(const_cast&lt;CMIP*&gt;(pMip)),thread));</div><div class="line">}</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --></p>
<p>The destructor frees the memory allocated in <code>readData()</code>.</p>
<p><div class="fragment"><div class="line">Cmultlotsize::~Cmultlotsize()</div><div class="line">{</div><div class="line"><span class="preprocessor">#ifdef __THREADS_</span></div><div class="line">    <span class="keywordflow">if</span> (!m_iThread) {</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        <span class="keywordflow">if</span> (m_ipDur)</div><div class="line">            <span class="keyword">delete</span>[] m_ipDur;</div><div class="line">        <span class="keywordflow">if</span> (m_dpCost)</div><div class="line">            <span class="keyword">delete</span>[] m_dpCost;</div><div class="line"><span class="preprocessor">#ifdef __THREADS_</span></div><div class="line">    }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">} // end of Cmultlotsize::~Cmultlotsize()</span></div></div><!-- fragment --></p>
<p>The implementation of <code>readData()</code> given below is straightforward, and, looking through the code, you can easily guess the structure of an input file.</p>
<p><div class="fragment"><div class="line"><span class="keywordtype">void</span> Cmultlotsize::readData(<span class="keyword">const</span> <span class="keywordtype">char</span>* fileName)</div><div class="line">{</div><div class="line">    std::ifstream fin(fileName);</div><div class="line">    <span class="keywordflow">if</span> (!fin.is_open()) {</div><div class="line">        <span class="keywordflow">throw</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCFileException.html">CFileException</a>(<span class="stringliteral">&quot;Cmultlotsize::readData&quot;</span>,fileName);</div><div class="line">    }</div><div class="line">    <span class="keywordtype">int</span> n,m,T;</div><div class="line">    fin &gt;&gt; n &gt;&gt; m &gt;&gt; T;</div><div class="line">    m_iProdNum=n; m_iMachTypeNum=m; m_iT=T;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (m_ipDur=<span class="keyword">new</span>(std::nothrow) <span class="keywordtype">int</span>[T + 3*n+ n*T + m*T]) {</div><div class="line">        <span class="keywordflow">if</span> (m_dpCost=<span class="keyword">new</span>(std::nothrow) <span class="keywordtype">double</span>[2*n*T+m*T+m*n+n*n]) {</div><div class="line">            m_ipFinalStock=(m_ipInitStock=(m_ipStockCap=m_ipDur+T)+n)+n;</div><div class="line">            m_ipMachNum=(m_ipDemand=m_ipFinalStock+n)+n*T;</div><div class="line">            m_dpFixedCost=(m_dpHoldingCost=m_dpCost+n*T)+n*T;</div><div class="line">            m_dpRho=(m_dpTau=m_dpFixedCost+m*T)+m*n;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (!m_dpCost) {</div><div class="line">        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMemoryException.html">CMemoryException</a>(<span class="stringliteral">&quot;Cmultlotsize::readData&quot;</span>);</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; n; ++j) {</div><div class="line">        fin &gt;&gt; m_ipStockCap[j] &gt;&gt; m_ipInitStock[j] &gt;&gt; m_ipFinalStock[j];</div><div class="line">    }</div><div class="line">    <span class="keywordtype">double</span> *c=m_dpCost, *f=m_dpFixedCost, *h=m_dpHoldingCost,</div><div class="line">        *tau=m_dpTau, *rho=m_dpRho;</div><div class="line">    <span class="keywordtype">int</span> k, *d=m_ipDemand, *mn=m_ipMachNum;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t=0; t &lt; T; ++t) {</div><div class="line">        fin &gt;&gt; k &gt;&gt; m_ipDur[t];</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; n; ++j)</div><div class="line">            fin &gt;&gt; *d++ &gt;&gt; *c++ &gt;&gt; *h++;</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; m; ++i)</div><div class="line">            fin &gt;&gt; *f++ &gt;&gt; *mn++;</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; m; ++i) {</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; n; ++j)</div><div class="line">            fin &gt;&gt; *tau++;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j &lt; n; ++j) {</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k &lt; n; ++k)</div><div class="line">            fin &gt;&gt; *rho++;</div><div class="line">    }</div><div class="line">    </div><div class="line">    fin.close();</div><div class="line">} <span class="comment">// end of Cmultlotsize::readData()</span></div></div><!-- fragment --></p>
<p>Our _MIPshell__ implementation of MIP (1) is straightforward.</p>
<p><div class="fragment"><div class="line"><span class="preprocessor">#define s0(j) m_ipInitStock[j]</span></div><div class="line"><span class="preprocessor">#define sf(j) m_ipFinalStock[j]</span></div><div class="line"><span class="preprocessor">#define u(j) m_ipStockCap[j]</span></div><div class="line"><span class="preprocessor">#define m(i,t) m_ipMachNum[t*m+i]</span></div><div class="line"><span class="preprocessor">#define f(i,t) m_dpFixedCost[t*m+i]</span></div><div class="line"><span class="preprocessor">#define c(j,t) m_dpCost[t*n+j]</span></div><div class="line"><span class="preprocessor">#define h(j,t) m_dpHoldingCost[t*n+j]</span></div><div class="line"><span class="preprocessor">#define d(j,t) m_ipDemand[t*n+j]</span></div><div class="line"><span class="preprocessor">#define l(t) m_ipDur[t]</span></div><div class="line"><span class="preprocessor">#define tau(i,j) m_dpTau[i*n+j]</span></div><div class="line"><span class="preprocessor">#define rho(j,k) m_dpRho[j*n+k]</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> Cmultlotsize::model()</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> i,j,k,t, m,n,T;</div><div class="line">    m=m_iMachTypeNum; n=m_iProdNum; T=m_iT;</div><div class="line">    <a class="code" href="classCVarVector.html">VAR_VECTOR</a> s(<span class="stringliteral">&quot;s&quot;</span>,<a class="code" href="Var_8h.html#a1cec2e482ee71e7e701a8ef2025f8ebaa3e58089cdeaafd3168fd5c68f146ef81">REAL_GE</a>,n,T), x(<span class="stringliteral">&quot;x&quot;</span>,<a class="code" href="Var_8h.html#a1cec2e482ee71e7e701a8ef2025f8ebaa9700b305a3d7a8829567b7ebc37ce1e8">INT_GE</a>,n,T), y(<span class="stringliteral">&quot;y&quot;</span>,<a class="code" href="Var_8h.html#a1cec2e482ee71e7e701a8ef2025f8ebaa5a063e265d2ac903b6808e9f6e73ec46">INTEGER</a>,m,T);</div><div class="line"></div><div class="line">    minimize(</div><div class="line">        sum(t in [0,T), j in [0,n)) c(j,t)*x(j,t)</div><div class="line">      + sum(t in [0,T), j in [0,n)) h(j,t)*s(j,t)</div><div class="line">      + sum(i in [0,m), t in [0,T)) f(i,t)*y(i,t)</div><div class="line">      );</div><div class="line">      </div><div class="line">    forall(j in [0,n))</div><div class="line">        s0(j) + x(j,0) == </div><div class="line">            d(j,0) + s(j,0) + sum(k in [0,n)) rho(j,k)*x(k,0);</div><div class="line">        </div><div class="line">    forall(t in [1,T), j in [0,n))</div><div class="line">        s(j,t-1) + x(j,t) == </div><div class="line">            d(j,t) + s(j,t) + sum(k in [0,n)) rho(j,k)*x(k,t);</div><div class="line">    </div><div class="line">    forall(i in [0,m), t in [0,T)) {</div><div class="line">        sum(j in [0,n)) tau(i,j)*x(j,t) &lt;= l(t)*y(i,t);</div><div class="line">        y(i,t) &lt;= m(i,t);</div><div class="line">    }</div><div class="line">        </div><div class="line">    forall(j in [0,n)) {</div><div class="line">        forall(t in [0,T))</div><div class="line">            s(j,t) &lt;= u(j);</div><div class="line">        s(j,T-1) == sf(j);</div><div class="line">    }</div><div class="line">        </div><div class="line">    optimize();</div><div class="line">    <a class="code" href="Problem_8h.html#a71d33b1bbfc010c85e7d36ab2fe3f058">printsol</a>();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="comment">// end of Cmultlotsize::model</span></div></div><!-- fragment --></p>
<p>To improve readability of the model, we introduced a few macros.</p>
<h2><a class="anchor" id="mipshell_multLotSizeExample"></a>
Example problem</h2>
<p>An engineering factory makes seven products (numbered from 1 to 7) on the following machines: four grinders, two vertical drills, three horizontal drills, one borer, one planer, and two packing devices. Products 5 and 7 are complete sets: one unit of Product 5 comprises one unit of Product 1 and one units of Product 3, and one unit of Product 7 comprises one unit of Product 1 and two unit of Product 6. Unit production times (in hours) required on each process are given in Table 1. A dash indicates that a product does not require a process. All required processes on each product unit can be applied in any order. So, no sequencing problem need to be considered.</p>
<center> <a class="anchor" id=""></a>
<table class="doxtable">
<caption>Table 1: <em>Unit Production Times</em></caption>
<tr>
<th></th><th colspan="7">Products  </th></tr>
<tr>
<th>Processes </th><th>1 </th><th>2 </th><th>3 </th><th>4 </th><th>5 </th><th>6 </th><th>7  </th></tr>
<tr>
<td>Grinding </td><td>0.5 </td><td>0.7 </td><td>&mdash; </td><td>&mdash; </td><td>0.3 </td><td>0.2 </td><td>0.5  </td></tr>
<tr>
<td>Vertical drilling </td><td>0.1 </td><td>0.2 </td><td>&mdash; </td><td>0.3 </td><td>&mdash; </td><td>0.6 </td><td>&mdash;  </td></tr>
<tr>
<td>Horizontal drilling </td><td>0.2 </td><td>&mdash; </td><td>0.8 </td><td>&mdash; </td><td>&mdash; </td><td>&mdash; </td><td>0.6  </td></tr>
<tr>
<td>Boring </td><td>0.05 </td><td>0.03 </td><td>&mdash; </td><td>0.07 </td><td>0.01 </td><td>&mdash; </td><td>0.08  </td></tr>
<tr>
<td>Planing </td><td>&mdash; </td><td>&mdash; </td><td>0.0 </td><td>&mdash; </td><td>0.05 </td><td>&mdash; </td><td>0.05  </td></tr>
<tr>
<td>Packing </td><td>0.1 </td><td>0.1 </td><td>0.1 </td><td>0.1 </td><td>0.1 </td><td>0.1 </td><td>0.15  </td></tr>
</table>
</center><p>The planning horizon consists of six months from January to June. The demands for products are given in Table 2. The factory works a 5 day week with two shifts of 8 hours each day. The number of working days in each month is also presented in Table 2.</p>
<center> <a class="anchor" id=""></a>
<table class="doxtable">
<caption>Table 2: <em>Demands for Products</em></caption>
<tr>
<th></th><th>Working </th><th colspan="7">Products  </th></tr>
<tr>
<th>Months </th><th>days </th><th>1 </th><th>2 </th><th>3 </th><th>4 </th><th>5 </th><th>6 </th><th>7  </th></tr>
<tr>
<td>January </td><td>19 </td><td>500 </td><td>1000 </td><td>300 </td><td>300 </td><td>800 </td><td>200 </td><td>100  </td></tr>
<tr>
<td>February </td><td>19 </td><td>600 </td><td>700 </td><td>200 </td><td>0 </td><td>400 </td><td>300 </td><td>150  </td></tr>
<tr>
<td>March </td><td>22 </td><td>300 </td><td>600 </td><td>0 </td><td>0 </td><td>500 </td><td>400 </td><td>100  </td></tr>
<tr>
<td>April </td><td>22 </td><td>200 </td><td>300 </td><td>400 </td><td>500 </td><td>200 </td><td>0 </td><td>10  </td></tr>
<tr>
<td>May </td><td>21 </td><td>0 </td><td>100 </td><td>500 </td><td>100 </td><td>1000 </td><td>300 </td><td>0  </td></tr>
<tr>
<td>June </td><td>21 </td><td>500 </td><td>500 </td><td>100 </td><td>300 </td><td>1100 </td><td>500 </td><td>60  </td></tr>
</table>
</center><p>During the planning horizon some machines will be down for maintenance: The setup cost of a machine mainly is the fixed salary of an operator. As the planer needs two operators, its setup cost is two times bigger than setup cost of the other machines. Machine setup costs, and the numbers of machines of each type available in each month are given in Table 3.</p>
<center> <a class="anchor" id=""></a>
<table class="doxtable">
<caption>Table 3: <em>Machines Available and their Setup Costs</em></caption>
<tr>
<th></th><th>Setup </th><th colspan="6">Available machines  </th></tr>
<tr>
<th>Machine </th><th>cost </th><th>Jan </th><th>Feb </th><th>Mar </th><th>Apr </th><th>May </th><th>Jun  </th></tr>
<tr>
<td>Grinder </td><td>500 </td><td>6 </td><td>5 </td><td>5 </td><td>6 </td><td>5 </td><td>5  </td></tr>
<tr>
<td>Ver. driller </td><td>450 </td><td>3 </td><td>3 </td><td>2 </td><td>2 </td><td>3 </td><td>3  </td></tr>
<tr>
<td>Hor. driller </td><td>450 </td><td>5 </td><td>3 </td><td>5 </td><td>5 </td><td>5 </td><td>5  </td></tr>
<tr>
<td>Borer </td><td>550 </td><td>2 </td><td>2 </td><td>1 </td><td>2 </td><td>1 </td><td>2  </td></tr>
<tr>
<td>Planer </td><td>1000 </td><td>1 </td><td>2 </td><td>2 </td><td>1 </td><td>2 </td><td>2  </td></tr>
<tr>
<td>Packing dev. </td><td>400 </td><td>2 </td><td>2 </td><td>2 </td><td>2 </td><td>2 </td><td>2  </td></tr>
</table>
</center><p>Unit production costs depend on the production period. It is 10% more expensive to produce in the cold months (January, February, and March) than in the warm ones (April, May, and June). These costs are given in Table 4.</p>
<center> <a class="anchor" id=""></a>
<table class="doxtable">
<caption>Table 4: <em>Production Costs</em></caption>
<tr>
<th></th><th colspan="7">Products  </th></tr>
<tr>
<th>Periods </th><th>1 </th><th>2 </th><th>3 </th><th>4 </th><th>5 </th><th>6 </th><th>7  </th></tr>
<tr>
<td>January, February, March </td><td>17 </td><td>19 </td><td>16.5 </td><td>8 </td><td>9 </td><td>16 </td><td>25  </td></tr>
<tr>
<td>April, May, June </td><td>16.3 </td><td>17.1 </td><td>14.9 </td><td>7.2 </td><td>8.1 </td><td>14.4 </td><td>22.5  </td></tr>
</table>
</center><p>It is possible to store up to 100 units of each product at a cost of $1 per unit per month. There are not stock at the beginning of the horizon but it is desired to have a stock of 50 units of each product at the end of June.</p>
<p>When and what should the factory produce to maximize the total profit?</p>
<p>To solve this example problem with our program described in the previous section, we prepared an input text file <code>test1.txt</code> located in the folder </p><pre class="fragment"> $MIPCLDIR/examples/mipshell/multlotsize/tests
</pre><p>Its content is as follows.</p>
<div class="fragment"><div class="line">7 6 6</div><div class="line"></div><div class="line">100 0 50  100 0 50  100 0 50  100 0 50</div><div class="line">100 0 50  100 0 50  100 0 50</div><div class="line"></div><div class="line">1  304</div><div class="line">500 17 1  1000 19 1  300 16.5 1  300 8 1  800 9 1  200 16 1  100 25 1</div><div class="line">500 6  450 3  450 5  550 2  1000 1  400 2</div><div class="line"></div><div class="line">2  304</div><div class="line">600 17 1   700 19 1  200 16.5 1    0 8 1  400 9 1  300 16 1  150 25 1</div><div class="line">500 5  450 3  450 3  550 2  1000 2  400 2</div><div class="line"></div><div class="line">3  352</div><div class="line">300 17 1   600 19 1    0 16.5 1    0 8 1  500 9 1  400 16 1  100 25 1</div><div class="line">500 5  450 2  450 5  550 1  1000 2  400 2</div><div class="line"></div><div class="line">4  352</div><div class="line">200 16.3 1  300 17.1 1  400 14.9 1  500 7.2 1   200 8.1 1    0 14.4 1  100 22.5 1</div><div class="line">500 6  450 2  450 5  550 2  1000 1  400 2</div><div class="line"></div><div class="line">5  336</div><div class="line">  0 16.3 1  100 17.1 1  500 14.9 1  100 7.2 1  1000 8.1 1  300 14.4 1    0 22.5 1</div><div class="line">500 5  450 3  450 5  550 1  1000 2  400 2</div><div class="line"></div><div class="line">6  336</div><div class="line">500 16.3 1  500 17.1 1  100 14.9 1  300 7.2 1  1100 8.1 1  500 14.4 1   60 22.5 1</div><div class="line">500 5  450 3  450 5  550 2  1000 2  400 2</div><div class="line"></div><div class="line">0.5   0.7   0.0   0.0   0.3   0.2  0.5</div><div class="line">0.1   0.2   0.0   0.3   0.0   0.6  0.0</div><div class="line">0.2   0.0   0.8   0.0   0.0   0.0  0.6</div><div class="line">0.05  0.03  0.0   0.07  0.01  0.0  0.08</div><div class="line">0.0   0.0   0.01  0.0   0.05  0.0  0.05</div><div class="line">0.1   0.1   0.1   0.1   0.1   0.1  0.15</div><div class="line"></div><div class="line">0  0  0  0  1  0  1</div><div class="line">0  0  0  0  0  0  0</div><div class="line">0  0  0  0  1  0  0</div><div class="line">0  0  0  0  0  0  0</div><div class="line">0  0  0  0  0  0  0</div><div class="line">0  0  0  0  0  0  1</div><div class="line">0  0  0  0  0  0  0 </div><div class="line"></div><div class="line"><span class="comment">//=========================</span></div><div class="line">n m T</div><div class="line">Stock Capacities - n numbers</div><div class="line">Initial Stock - n numbers</div><div class="line">Final Stock - n numbers</div><div class="line"><span class="comment">//-------------------------</span></div><div class="line">Each period is described by 3 lines, 3*T lines in total</div><div class="line">t  Working Time (in hours) - 2 numbers</div><div class="line">Demand  Unit Production Cost Holding Cost - 3*n numbers in the line</div><div class="line">f_{it} m_{it} - 2*m numbers in the line</div><div class="line"><span class="comment">//-------------------------</span></div><div class="line">\tau_{ij} - m lines with n numbers in each</div><div class="line"><span class="comment">//-------------------------</span></div><div class="line">\rho_{jk} - n lines with n numbers in each</div></div><!-- fragment --><p>Input data is structured as given in the comments at the end of the file.</p>
<p>If we open a console window, enter the commands </p><pre class="fragment"> cd $MIPCLDIR/examples/mipshell/multlotsize/tests
 ../bin/multlotsize test1
</pre><p>we will get the solution in the text file <code>test1.sol</code>. In a concise form this solution is presented in tables 5 and 6.</p>
<center> <a class="anchor" id=""></a>
<table class="doxtable">
<caption>Table 5: <em>Machines Used</em></caption>
<tr>
<th></th><th colspan="6">Used machines  </th></tr>
<tr>
<th>Machine </th><th>Jan </th><th>Feb </th><th>Mar </th><th>Apr </th><th>May </th><th>Jun  </th></tr>
<tr>
<td>Grinder </td><td>6 </td><td>5 </td><td>3 </td><td>2 </td><td>3 </td><td>5  </td></tr>
<tr>
<td>Ver. driller </td><td>3 </td><td>2 </td><td>2 </td><td>1 </td><td>1 </td><td>3  </td></tr>
<tr>
<td>Hor. driller </td><td>5 </td><td>3 </td><td>2 </td><td>2 </td><td>5 </td><td>4  </td></tr>
<tr>
<td>Borer </td><td>1 </td><td>1 </td><td>1 </td><td>1 </td><td>1 </td><td>1  </td></tr>
<tr>
<td>Planer </td><td>1 </td><td>1 </td><td>1 </td><td>1 </td><td>1 </td><td>1  </td></tr>
<tr>
<td>Packing dev. </td><td>2 </td><td>2 </td><td>1 </td><td>1 </td><td>2 </td><td>2  </td></tr>
</table>
</center><p><br />
 </p><center> <a class="anchor" id=""></a>
<table class="doxtable">
<caption>Table 6: <em>Products Produced and Stocked</em></caption>
<tr>
<th></th><th></th><th colspan="7">Products  </th></tr>
<tr>
<th colspan="2">Months </th><th>1 </th><th>2 </th><th>3 </th><th>4 </th><th>5 </th><th>6 </th><th>7  </th></tr>
<tr>
<td>Jan </td><td>Produced </td><td>1400 </td><td>1000 </td><td>1100 </td><td>300 </td><td>800 </td><td>300 </td><td>100  </td></tr>
<tr>
<td>Jan </td><td>Stocked </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>Feb </td><td>Produced </td><td>1245 </td><td>700 </td><td>600 </td><td>0 </td><td>400 </td><td>545 </td><td>245  </td></tr>
<tr>
<td>Feb </td><td>Stocked </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>95  </td></tr>
<tr>
<td>Mar</td><td>Produced </td><td>825 </td><td>600 </td><td>500 </td><td>0 </td><td>500 </td><td>405 </td><td>5  </td></tr>
<tr>
<td>Mar </td><td>Stocked </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>Apr</td><td>Produced </td><td>529 </td><td>340 </td><td>600 </td><td>500 </td><td>200 </td><td>135 </td><td>129  </td></tr>
<tr>
<td>Apr </td><td>Stocked </td><td>0 </td><td>40 </td><td>0 </td><td>0 </td><td>0 </td><td>0 </td><td>29  </td></tr>
<tr>
<td>May</td><td>Produced </td><td>1104 </td><td>96 </td><td>1600 </td><td>100 </td><td>1100 </td><td>294 </td><td>0  </td></tr>
<tr>
<td>May </td><td>Stocked </td><td>4 </td><td>36 </td><td>0 </td><td>0 </td><td>100 </td><td>0 </td><td>29  </td></tr>
<tr>
<td>Jun</td><td>Produced </td><td>1677 </td><td>514 </td><td>1200 </td><td>350 </td><td>1050 </td><td>631 </td><td>81  </td></tr>
<tr>
<td>Jun </td><td>Stocked </td><td>50 </td><td>50 </td><td>50 </td><td>50 </td><td>50 </td><td>50 </td><td>50  </td></tr>
</table>
</center> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
