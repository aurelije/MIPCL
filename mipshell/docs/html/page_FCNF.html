<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MIPschell: Fixed Charge Network Flows</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MIPschell
   &#160;<span id="projectnumber">1.4.0</span>
   </div>
   <div id="projectbrief">A language for writing Mixed Integer Programs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Fixed Charge Network Flows </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="mipshell_FCNF"></a>
Fixed Charge Network Flows</h1>
<p>In the previous section we solved a particular MIP instance. But usually we need to develop computer programs that solve problems which are subclasses of MIP. In this section we describe a <b>MIPshell</b> implementation of the fixed charge network flow problem.</p>
<p>A transportation network is given by a <em>directed graph</em> (<em>digraph</em>) <img class="formulaInl" alt="$G=(V,E)$" src="form_2.png"/>. For each node <img class="formulaInl" alt="$v\in V$" src="form_3.png"/>, we know the <em>demand</em> <img class="formulaInl" alt="$d_v$" src="form_4.png"/> in some product. If <img class="formulaInl" alt="$d_v &gt; 0$" src="form_5.png"/>, then <em>v</em> is a demand node; if <img class="formulaInl" alt="$d_v &lt; 0$" src="form_6.png"/>, then <em>v</em> is a supply node; <img class="formulaInl" alt="$d_v=0$" src="form_7.png"/> for transit nodes. It is assumed that supply and demand are balanced: <img class="formulaInl" alt="$\sum_{v\in V} d_v = 0$" src="form_8.png"/>. The capacity of an arc <img class="formulaInl" alt="$e\in E$" src="form_9.png"/> is <img class="formulaInl" alt="$u_e &gt; 0$" src="form_10.png"/>, and the cost of shipping <img class="formulaInl" alt="$x_e &gt; 0$" src="form_11.png"/> units of product along this arc is <img class="formulaInl" alt="$f_e + c_e x_e$" src="form_12.png"/>. Naturally, if the product is not moved through the arc ( <img class="formulaInl" alt="$x_e=0$" src="form_13.png"/>), then nothing is paid. The <em>fixed charge network flow problem</em> (<em>FCNF</em>) is to decide on how to transport the product from supply nodes to demand nodes so that the transportation expenses are minimum.</p>
<p>The FCNF problem appears as a subproblem in many practical applications such as design of transportation and telecommunication networks, production planning problems.</p>
<p>An instance of FCNF problem is presented in the Figure 1, where the node numbers and demands are depicted in the upper and lower segments of the node circles. Any (undirected) edge <img class="formulaInl" alt="$e=(i,j)$" src="form_14.png"/> represents two (directed) arcs <img class="formulaInl" alt="$e_1=(i,j)\text{ and } e_2=(j,i)$" src="form_15.png"/>. All horizontal arcs have capacity <img class="formulaInl" alt="$u_e=3$" src="form_16.png"/>, fixed cost <img class="formulaInl" alt="$f_e=1$" src="form_17.png"/> and per-unit cost <img class="formulaInl" alt="$c_e=0$" src="form_18.png"/>, and all vertical arcs have capacity <img class="formulaInl" alt="$u_e=4$" src="form_19.png"/>, fixed cost <img class="formulaInl" alt="$f_e=2$" src="form_20.png"/> and per-unit cost <img class="formulaInl" alt="$c_e=0$" src="form_18.png"/>.</p>
<div class="image">
<img src="gridgraph.png" alt="gridgraph.png"/>
<div class="caption">
Figure 1: Example of FCNF</div></div>
 Introducing variables</p><ul>
<li><img class="formulaInl" alt="$x_e$" src="form_21.png"/>: <em>flow</em> (quantity of shipping product) through arc <img class="formulaInl" alt="$e\in E$" src="form_9.png"/>,</li>
<li><img class="formulaInl" alt="$y_e=1$" src="form_22.png"/>, if product is shipped ( <img class="formulaInl" alt="$x_e &gt; $" src="form_23.png"/>) through arc <img class="formulaInl" alt="$e$" src="form_24.png"/>, and <img class="formulaInl" alt="$y_e=0$" src="form_25.png"/> otherwise,</li>
</ul>
<p>we formulate the FCNF problem as follows: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align} \sum_{e\in E} (f_e y_e + c_e x_e) \to \min,&amp; \tag{1.a} \\ \sum_{e\in E(V,v)} x_e - \sum_{e\in E(v,V)} x_e = d_v,&amp;\quad v\in V,\tag{1.b}\\ 0\le x_e \le u_e y_e,&amp;\quad e\in E,\tag{1.c}\\ y_e \in \{0,1\},&amp;\quad e\in E.\tag{1.d} \end{align}" src="form_26.png"/>
</p>
<p> Here the objective (1.a) minimizes transportation expenses. The <em>balance equations</em> (1.b) require that the number of flow units entering each particular node equals the number of flow units leaving the node. The <em>variable upper bounds</em> (1.c) are <em>capacity restrictions</em> with the following meaning:</p><ul>
<li>the flow value through any arc cannot exceed the capacity of the arc;</li>
<li>if some arc is not used for shipping product ( <img class="formulaInl" alt="$y_e=0$" src="form_25.png"/>),</li>
<li>then the flow value through this arc is zero ( <img class="formulaInl" alt="$x_e=0$" src="form_13.png"/>).</li>
</ul>
<h2><a class="anchor" id="mipshell_FCNFimplementation"></a>
MIPshell implementation</h2>
<p>A straightforward <b>MIPshell</b> implementation of IP (1) is given in Listings below.</p>
<p>The function <code>main()</code> creates an object named <code>prob</code> of class <code>Cfcnf</code> for an FCNF instance from a file passed to <code>main()</code> as its only parameter. Then <code>main()</code> calls the function <code>model()</code> (of the base class <code><a class="el" href="classCProblem.html" title="CProblem represents MIP instances. ">CProblem</a></code>) to build and then solve a model for the FCNF instance stored in <code>prob</code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;fcnf.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        Cfcnf prob(argv[1]);</div><div class="line">        prob.model();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span>(<a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCException.html">CException</a>* pe) {</div><div class="line">        std::cerr &lt;&lt; pe-&gt;<a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCException.html#aefac240f575195c800a6d2a84c215afe">what</a>() &lt;&lt; std::endl;</div><div class="line">        <span class="keyword">delete</span> pe;</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div></div><!-- fragment --><p>Class <code>Cfcnf</code> is defined as follows.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mipshell_8h.html">mipshell.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>Cfcnf: <span class="keyword">public</span> <a class="code" href="classCProblem.html">CProblem</a></div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> m_iVertNum, m_iEdgeNum,*m_ipTail,*m_ipHead;</div><div class="line">    <span class="keywordtype">double</span> *m_dpCapacity,*m_dpFixedCost,*m_dpCost,*m_dpDemand;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Cfcnf(<span class="keyword">const</span> <span class="keywordtype">char</span>* fileName);</div><div class="line"><span class="preprocessor">#ifndef __ONE_THREAD_</span></div><div class="line">    Cfcnf(<span class="keyword">const</span> Cfcnf &amp;other, <span class="keywordtype">int</span> thread);</div><div class="line">    <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a>* <a class="code" href="classCProblem.html#a652138eae3153e0bbb7a8e78cb488600">clone</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a> *pMip, <span class="keywordtype">int</span> thread);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <span class="keyword">virtual</span> ~Cfcnf();</div><div class="line">    <span class="keywordtype">int</span> model();</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="classCProblem.html#a1b7e983f014fb91903a35513531d9c3b">printSolution</a>(<a class="code" href="classCVarVector.html">VAR_VECTOR</a> &amp;flow);</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keywordtype">void</span> readNet(<span class="keyword">const</span> <span class="keywordtype">char</span>* fileName);</div><div class="line">};</div><div class="line"></div></div><!-- fragment --><p>Its members are:</p><ul>
<li><code>m_iVertNum</code>: number of nodes;</li>
<li><code>m_iEdgeNum</code>: number of arcs;</li>
<li><code>m_ipTail[e]</code>, <code>m_ipHead[e]</code>: tail and head of arc e=(m_ipTail[e],m_ipHead[e]);</li>
<li><code>m_ipDemand[v]</code>: demand for flow at node <code>v</code>;</li>
<li><code>m_ipCapacity[e]</code>, <code>m_ipCost[e]</code>, <code>m_ipFixedCost[e]</code>: respectively, capacity, cost and fixed cost of arc <code>e</code>.</li>
</ul>
<p>Next, we discuss the implementation of the constructors and the destructor of <code>Cfcnf</code>.</p>
<p>The constructor calls <code>readNet(fileName)</code> to read the description of an FCNF instance from the file which name is passed as the only input parameter <code>fileName</code>.</p>
<p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div><div class="line"></div><div class="line">Cfcnf::Cfcnf(<span class="keyword">const</span> <span class="keywordtype">char</span>* name): <a class="code" href="classCProblem.html">CProblem</a>(name)</div><div class="line">{</div><div class="line">    m_ipTail=m_ipHead=0;</div><div class="line">    m_dpCapacity=m_dpFixedCost=m_dpCost=m_dpDemand=0;</div><div class="line">    <span class="keywordtype">char</span> fileName[128];</div><div class="line">    strncpy(fileName,name,123);</div><div class="line">    strcat(fileName,<span class="stringliteral">&quot;.txt&quot;</span>);</div><div class="line">    readNet(fileName);</div><div class="line">}</div></div><!-- fragment --></p>
<p>The implementations of the copy and clone constructors are standard for all <b>MIPCL</b> applications that do not overload any function of the base classes <code><a class="elRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a></code> or <code><a class="elRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCLP.html">CLP</a></code>.</p>
<p><div class="fragment"><div class="line">Cfcnf::Cfcnf(<span class="keyword">const</span> Cfcnf &amp;other, <span class="keywordtype">int</span> thread): <a class="code" href="classCProblem.html">CProblem</a>(other,thread)</div><div class="line">{</div><div class="line">} <span class="comment">// end of Cfcnf::Cfcnf(Cfcnf &amp;other, int thread)</span></div><div class="line"></div><div class="line"><a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a>* Cfcnf::clone(<span class="keyword">const</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a> *pMip, <span class="keywordtype">int</span> thread)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMIP.html">CMIP</a>*<span class="keyword">&gt;</span>(<span class="keyword">new</span> Cfcnf(*static_cast&lt;Cfcnf*&gt;(const_cast&lt;CMIP*&gt;(pMip)),thread));</div><div class="line">}</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --></p>
<p>The destructor frees the memory allocated in <code>readNet()</code> for the arrays describing the network. Since these arrays are used only by the root thread to pose a <b>MIPshell</b>-model and then to write an optimal solution to a file, we do not need to share these arrays with the other threads.</p>
<p><div class="fragment"><div class="line">Cfcnf::~Cfcnf()</div><div class="line">{</div><div class="line"><span class="preprocessor">#ifndef __ONE_THREAD_</span></div><div class="line">    <span class="keywordflow">if</span> (!m_iThread) {</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        <span class="keywordflow">if</span> (m_ipTail)</div><div class="line">            <span class="keyword">delete</span>[] m_ipTail;</div><div class="line">        <span class="keywordflow">if</span> (m_dpCapacity)</div><div class="line">            <span class="keyword">delete</span>[] m_dpCapacity; </div><div class="line"><span class="preprocessor">#ifndef __ONE_THREAD_</span></div><div class="line">    }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">} // end of Cfcnf::~Cfcnf</span></div></div><!-- fragment --></p>
<p>The function <code>readNet()</code> reads an instance of FCNF from a text file of the following format: Line 1 contains 2 integer numbers <em>n</em> and <em>m</em> (number of nodes and number of edges); staring from Line 2, node demands are written as <em>n</em> integer numbers, the <em>i</em>-th number is the demand at node <em>i</em>; demands are followed by <em>m</em> lines with arc parameters, the <em>i</em>-th of these lines contains 5 numbers, respectively, the head, tail, capacity, fixed cost, and cost of arc <em>i</em>. Our test example on the grid graph is described in the file <code>grid.txt</code> which can be found in the folder </p><pre class="fragment">$MIPCLDIR/examples/mipshell/fcfn/tests
</pre><p>reserved for our FCFN application.</p>
<p><div class="fragment"><div class="line"><span class="keywordtype">void</span> Cfcnf::readNet(<span class="keyword">const</span> <span class="keywordtype">char</span>* fileName)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> n,m;</div><div class="line">    std::ifstream fin(fileName);</div><div class="line">    <span class="keywordflow">if</span> (!fin.is_open()) {</div><div class="line">        <span class="keywordflow">throw</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCFileException.html">CFileException</a>(<span class="stringliteral">&quot;Cfcnf::ReadNet&quot;</span>,fileName);</div><div class="line">    }</div><div class="line">    fin &gt;&gt; n &gt;&gt; m;</div><div class="line">    m_iVertNum=n; m_iEdgeNum=m;</div><div class="line">    <span class="keywordflow">if</span> (m_ipTail = <span class="keyword">new</span>(std::nothrow) <span class="keywordtype">int</span>[2*m])</div><div class="line">        m_dpCapacity = <span class="keyword">new</span>(std::nothrow) <span class="keywordtype">double</span>[3*m+n];</div><div class="line">    <span class="keywordflow">if</span> (!m_dpCapacity) {</div><div class="line">        <span class="keywordflow">if</span> (!m_ipTail)</div><div class="line">            <span class="keyword">delete</span>[] m_ipTail;</div><div class="line">        <span class="keywordflow">throw</span> <a class="codeRef" doxygen="/home/nick/programs/mip/mipcl/docs/mipcl.tag:../../../mipcl/docs/html/" href="../../../mipcl/docs/html/classCMemoryException.html">CMemoryException</a>(<span class="stringliteral">&quot;Cfcnf::ReadNet&quot;</span>);</div><div class="line">    }</div><div class="line">    m_dpDemand=(m_dpCost=(m_dpFixedCost=m_dpCapacity+m)+m)+m;</div><div class="line">    m_ipHead = m_ipTail+m;</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; n; ++i) {</div><div class="line">        fin &gt;&gt; m_dpDemand[i];</div><div class="line">    }</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; m; ++i) {</div><div class="line">        fin &gt;&gt; m_ipTail[i] &gt;&gt; m_ipHead[i] &gt;&gt; m_dpCapacity[i] </div><div class="line">            &gt;&gt; m_dpFixedCost[i] &gt;&gt; m_dpCost[i];</div><div class="line">    }</div><div class="line">    fin.close();</div><div class="line">} <span class="comment">// end of Cfcnf::readNet  </span></div></div><!-- fragment --></p>
<p>The standard <b>MIPshell</b> implementation of <code><a class="el" href="Problem_8h.html#a71d33b1bbfc010c85e7d36ab2fe3f058" title="alias for CProblem::printFinalSolution() ">printsol()</a></code> writes to an output file the values of all the problem variables. In most cases we can write down solutions in a more readable form. The function <code>printSolution()</code> writes down only non-zero arc flows.</p>
<p><div class="fragment"><div class="line"><span class="keywordtype">void</span> Cfcnf::printSolution(<a class="code" href="classCVarVector.html">VAR_VECTOR</a> &amp;flow)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> m=m_iEdgeNum;</div><div class="line">    <span class="keywordtype">char</span> fileName[128];</div><div class="line">    getProblemName(fileName);</div><div class="line">    std::strcat(fileName,<span class="stringliteral">&quot;.sol&quot;</span>);</div><div class="line">    std::ofstream fout(fileName);</div><div class="line">    <span class="keywordflow">if</span> (isSolution()) {</div><div class="line">        fout &lt;&lt; <span class="stringliteral">&quot;Nonzero flows:\n&quot;</span>;</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> e=0; e &lt; m; ++e) {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="Problem_8h.html#a029fa4f1fc382f0ddc992f769969cd0f">getval</a>(flow(e)) &gt; 0.5)  {</div><div class="line">                fout &lt;&lt; <span class="stringliteral">&quot;flow(&quot;</span> &lt;&lt; m_ipTail[e] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> </div><div class="line">                    &lt;&lt; m_ipHead[e] &lt;&lt; <span class="stringliteral">&quot;)=&quot;</span></div><div class="line">                    &lt;&lt; <a class="code" href="Problem_8h.html#a029fa4f1fc382f0ddc992f769969cd0f">getval</a>(flow(e)) &lt;&lt; std::endl;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        fout &lt;&lt; <span class="stringliteral">&quot;Problem has no solution!\n&quot;</span>;</div><div class="line">    }</div><div class="line">    fout.close();</div><div class="line">} <span class="comment">// end of Cfcnf::printSolution</span></div></div><!-- fragment --></p>
<p>The function <code>model()</code> translates IP model (1) into a <b>MIPshell</b> model. For this translation be more transparent, we introduced a number of macros that map the parameters of the MIP model into the program parameters.</p>
<p><div class="fragment"><div class="line"><span class="comment">// macros for improving readability</span></div><div class="line"><span class="preprocessor">#define t(e) m_ipTail[e]</span></div><div class="line"><span class="preprocessor">#define h(e) m_ipHead[e]</span></div><div class="line"><span class="preprocessor">#define c(e) m_dpCost[e]</span></div><div class="line"><span class="preprocessor">#define f(e) m_dpFixedCost[e]</span></div><div class="line"><span class="preprocessor">#define u(e) m_dpCapacity[e]</span></div><div class="line"><span class="preprocessor">#define d(v) m_dpDemand[v]</span></div></div><!-- fragment --></p>
<p>With these definitions our implementation of <code>model()</code> is as follows.</p>
<p><div class="fragment"><div class="line"><span class="keywordtype">int</span> Cfcnf::model()</div><div class="line">{</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> zero=0.000001;</div><div class="line">    <span class="keywordtype">bool</span> suppl;</div><div class="line">    <span class="keywordtype">double</span> z;</div><div class="line">    <span class="keywordtype">int</span> v,e, n=m_iVertNum, m=m_iEdgeNum;</div><div class="line">    <a class="code" href="classCVarVector.html">VAR_VECTOR</a> x(<span class="stringliteral">&quot;x&quot;</span>,<a class="code" href="Var_8h.html#a1cec2e482ee71e7e701a8ef2025f8ebaa3e58089cdeaafd3168fd5c68f146ef81">REAL_GE</a>,m);</div><div class="line">    <a class="code" href="classCVarVector.html">VAR_VECTOR</a> y(<span class="stringliteral">&quot;y&quot;</span>,<a class="code" href="Var_8h.html#a1cec2e482ee71e7e701a8ef2025f8ebaa3dba92f17ebb0d7efe6056d51e9acdc7">BIN</a>,m);</div><div class="line">    </div><div class="line">    z=0.0;</div><div class="line">    forall(v in [0,n))</div><div class="line">        z+=d(v);</div><div class="line">        </div><div class="line">    suppl=(z &lt;  -zero)? <span class="keyword">true</span>: <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    minimize(sum(e in [0,m)) (f(e)*y(e) + c(e)*x(e)));</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (suppl) {</div><div class="line">        forall(v in [0,n): d(v) &lt; -zero)</div><div class="line">            sum(e in [0,m): h(e)==v) x(e)  - sum(e in [0,m): t(e)==v) x(e) &gt;= d(v);</div><div class="line">        </div><div class="line">        forall(v in [0,n): d(v) &gt;= -zero)</div><div class="line">            sum(e in [0,m): h(e)==v) x(e)  - sum(e in [0,m): t(e)==v) x(e) == d(v);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        forall(v in [0,n): d(v) &gt; zero)</div><div class="line">            sum(e in [0,m): h(e)==v) x(e)  - sum(e in [0,m): t(e)==v) x(e) &lt;= d(v);</div><div class="line">        </div><div class="line">        forall(v in [0,n): d(v) &lt;= zero)</div><div class="line">            sum(e in [0,m): h(e)==v) x(e)  - sum(e in [0,m): t(e)==v) x(e) == d(v);</div><div class="line">    }</div><div class="line">        </div><div class="line">    forall(e in [0,m))</div><div class="line">        x(e) &lt;= u(e)*y(e);</div><div class="line">        </div><div class="line"><span class="comment">//  preprocoff();</span></div><div class="line">        </div><div class="line">    optimize();</div><div class="line">    printSolution(x);</div><div class="line">    </div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="comment">// end of Cfcnf::model</span></div></div><!-- fragment --></p>
<p>After the objective and the constraints are formulated, we call first <code>optimize()</code> to solve the problem, and then <code>printSolution()</code> to write an optimal solution to a file.</p>
<p><b>MIPshell</b> translates the model stored in <code>fcnf.mod</code> into a <b>C++</b> file <code>fcnf.xyz</code> which is included into <code>fcnf.cpp</code>.</p>
<p>After compiling and then running our test program with input parameter set to <code>grid.txt</code>, we get the answer written into the file named <code>grid.txt.sol</code>, and depicted in Figure 2.</p>
<div class="image">
<img src="gridgraphSol.png" alt="gridgraphSol.png"/>
<div class="caption">
Figure 2: Solution to FCNF example</div></div>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
